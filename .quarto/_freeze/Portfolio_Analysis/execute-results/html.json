{
  "hash": "af397c7ef5846eaaeb0e87fc1868fd14",
  "result": {
    "markdown": "---\ntitle: \"Portfolio Analysis\"\n#author: \"Jennat Lamsatfi\"\neval: true\ntheme:\n  light: flatly\n  dark: darkly\ntoc: true\nformat:\n  html:\n    code-fold: true\nengine: knitr\n---\n\n::: {.cell}\n\n:::\n\n\n## Context\n\nMeasure Portfolio risk using some descriptive statistics but yet very powerful to guide one's analysis and give more insights about models to be used to explain the relationship between risk and return.\n\n## Assets Returns\n\nWe are taking raw price data for $5$ individual assets in order to transform them into monthly returns for a signle portfolio. The portfolio consists of five Exchane Traded Funds (ETF):\n\n* S $\\&$ P $500$ ETF (SP) weighted $25 \\%$\n* A non-US equities ETF (EF) weighted $25 \\%$\n* A small-cap value ETF (SC) weighted $20 \\%$\n* An emerging-markets ETF (EM) weighted $20 \\%$\n* A bond ETF (BG) weighted $10 \\%$\n\nWe are taking $5$ years worth of data (the csv file containg data is called *Data*) from Yahoo Finance with the starting date \"$2012/12/31$\" and the ending date \"$2017/12/31$\".\n\n:::{.panel-tabset}\n\n## Data \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#  importing daily price data for the 5 ETF and save them to an xts object  'prices'.\nsymbols = c(\"SP\",\"EF\", \"SC\", \"EM\",\"BG\")\nprices = read_csv(\"C:\\\\Users\\\\HJasm\\\\OneDrive\\\\Bureau\\\\Projets\\\\data_analysis_VScode\\\\Data.csv\",\n\tcol_types =\n\t\tcols(date =\n\t\t\tcol_date(format = \"%Y-%m-%d\"))) %>%\ntk_xts(date_var = date)\nhead(prices,10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                 SP       EF       SC       EM       BG\n2012-12-31 128.3092 49.16410 75.06590 39.89233 98.19626\n2013-01-02 131.5977 49.92501 77.12553 40.67489 98.08131\n2013-01-03 131.3004 49.44080 77.02349 40.38705 97.83374\n2013-01-04 131.8771 49.69155 77.62656 40.46800 97.93983\n2013-01-07 131.5166 49.47539 77.17194 40.16218 97.88681\n2013-01-08 131.1382 49.19869 76.87505 39.80238 97.97523\n2013-01-09 131.4716 49.44944 77.09772 39.97328 97.90449\n2013-01-10 132.5168 50.08064 77.19049 40.32409 97.89565\n2013-01-11 132.5077 50.18440 77.13483 40.00026 97.99291\n2013-01-14 132.4177 50.24492 77.11628 40.17117 98.08131\n```\n:::\n:::\n\n\n \n\n## Monthly Returns \n\nConverting Daily Prices to Monthly Returns using the *log* method. We are using *xts* from the *quantmod* package as it does the conversion easily (we could use *tidyverse* also to do the same transformation). We decide to take the first observation in our data as the last trading day of the year.\n\n::: {.cell}\n\n```{.r .cell-code}\nprices_monthly = to.monthly(prices,\n\t\t\t\t\t\t\tindexAt = \"lastof\",\n\t\t\t\t\t\t\tOHLC = FALSE)\nasset_returns_xts =\n\t\tReturn.calculate(prices_monthly,\n\t\t\t\t\t\tmethod = \"log\") %>%\nna.omit()\nhead(asset_returns_xts, 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                    SP          EF           SC           EM           BG\n2013-01-31  0.04992297  0.03660636  0.052133434 -0.002935495 -0.006231517\n2013-02-28  0.01267831 -0.01296938  0.016175220 -0.023105260  0.005891222\n2013-03-31  0.03726793  0.01296938  0.040258083 -0.010235026  0.000984796\n2013-04-30  0.01902996  0.04896776  0.001222613  0.012084966  0.009639339\n2013-05-31  0.02333554 -0.03065561  0.041976308 -0.049483623 -0.020214051\n2013-06-30 -0.01343450 -0.02715330 -0.001402980 -0.054739041 -0.015778190\n2013-07-31  0.05038594  0.05186026  0.063541197  0.013159871  0.002687528\n2013-08-31 -0.03045115 -0.01974619 -0.034743332 -0.025705602 -0.008297969\n2013-09-30  0.03115574  0.07533845  0.063870562  0.069588712  0.011144078\n2013-10-31  0.04526645  0.03208178  0.034234199  0.040861329  0.008291862\n```\n:::\n:::\n\n\n \n## Visualization of assets returns\n\nA quick visualization in @fig-returns for the monthly log returns of each ETF.\n\n::: {.cell}\n\n```{.r .cell-code}\nhighchart(type = \"stock\") %>%\n\thc_title(text = \"Monthly Log Returns\") %>%\n\thc_add_series(asset_returns_xts[, symbols[1]],\n\t\tname = symbols[1]) %>%\n\thc_add_series(asset_returns_xts[, symbols[2]],\n\t\tname = symbols[2]) %>%\n\thc_add_series(asset_returns_xts[, symbols[3]],\n\t\tname = symbols[3]) %>%\n\thc_add_series(asset_returns_xts[, symbols[4]],\n\t\tname = symbols[4]) %>%\n\thc_add_series(asset_returns_xts[, symbols[5]],\n\t\tname = symbols[5]) %>%\n\thc_add_theme(hc_theme_flat()) %>%\n\thc_navigator(enabled = FALSE) %>%\n\thc_scrollbar(enabled = FALSE) %>%\n\thc_exporting(enabled = TRUE) %>%\n\thc_legend(enabled = TRUE)\n```\n\n::: {#fig-returns .cell-output-display}\n```{=html}\n<div class=\"highchart html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-64cb395e4172b8980f7e\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-64cb395e4172b8980f7e\">{\"x\":{\"hc_opts\":{\"chart\":{\"reflow\":true},\"title\":{\"text\":\"Monthly Log Returns\"},\"yAxis\":{\"title\":{\"text\":null}},\"credits\":{\"enabled\":false},\"exporting\":{\"enabled\":true},\"boost\":{\"enabled\":false},\"plotOptions\":{\"series\":{\"label\":{\"enabled\":false},\"turboThreshold\":0},\"treemap\":{\"layoutAlgorithm\":\"squarified\"}},\"series\":[{\"data\":[[1359590400000,0.0499229684750562],[1362009600000,0.0126783064974649],[1364688000000,0.0372679302958732],[1367280000000,0.0190299561882163],[1369958400000,0.0233355435829417],[1372550400000,-0.0134345036208492],[1375228800000,0.0503859423925439],[1377907200000,-0.0304511509934642],[1380499200000,0.0311557415725146],[1383177600000,0.0452664479159646],[1385769600000,0.0292068669449934],[1388448000000,0.0255975500685599],[1391126400000,-0.0358845680703457],[1393545600000,0.0445105212628771],[1396224000000,0.00825899101816052],[1398816000000,0.00692748537091159],[1401494400000,0.0229412388670553],[1404086400000,0.0204329538190615],[1406764800000,-0.0135286228472031],[1409443200000,0.0387050128707767],[1412035200000,-0.0138914870976246],[1414713600000,0.0232778555456852],[1417305600000,0.0271013695694808],[1419984000000,-0.00254028265622264],[1422662400000,-0.0300771936761439],[1425081600000,0.0546821493433152],[1427760000000,-0.0158314857747115],[1430352000000,0.00978601546958213],[1433030400000,0.0127742418546086],[1435622400000,-0.0203250982934167],[1438300800000,0.0219061561058105],[1440979200000,-0.0633070590651519],[1443571200000,-0.0253952003308955],[1446249600000,0.0818438478405952],[1448841600000,0.00364850196181088],[1451520000000,-0.0174358377504928],[1454198400000,-0.0510686256577895],[1456704000000,-0.000826322621327868],[1459382400000,0.0650984027137573],[1461974400000,0.00393343223643772],[1464652800000,0.0168685077498187],[1467244800000,0.00347182090872877],[1469923200000,0.0358220317693059],[1472601600000,0.00119670389985682],[1475193600000,5.83956045812073e-05],[1477872000000,-0.0174890266019974],[1480464000000,0.0361761115990245],[1483142400000,0.0200686581848641],[1485820800000,0.0177365329766994],[1488240000000,0.0385391843912695],[1490918400000,0.00124919411121294],[1493510400000,0.00987722044430317],[1496188800000,0.014014248361585],[1498780800000,0.00635469680993417],[1501459200000,0.0203458592996055],[1504137600000,0.00291339675646451],[1506729600000,0.0199491538958627],[1509408000000,0.0232907586883302],[1512000000000,0.0301079902830876],[1514678400000,0.0158325647480932]],\"name\":\"SP\"},{\"data\":[[1359590400000,0.036606357660212],[1362009600000,-0.0129693768058883],[1364688000000,0.0129693768058883],[1367280000000,0.0489677595647868],[1369958400000,-0.030655605808199],[1372550400000,-0.0271532966165866],[1375228800000,0.0518602597204674],[1377907200000,-0.0197461885739507],[1380499200000,0.0753384524755201],[1383177600000,0.0320817766326984],[1385769600000,0.00544941923570352],[1388448000000,0.0215238060420591],[1391126400000,-0.0534132609941533],[1393545600000,0.0595048851401234],[1396224000000,-0.00460253733671756],[1398816000000,0.0165294028420071],[1401494400000,0.0158284861147804],[1404086400000,0.00916827518237717],[1406764800000,-0.026379531422247],[1409443200000,0.00180028858170189],[1412035200000,-0.0395984855950884],[1414713600000,-0.00265472923986465],[1417305600000,0.000625248276797663],[1419984000000,-0.0407436874213323],[1422662400000,0.00622641171696525],[1425081600000,0.0614506453899422],[1427760000000,-0.0143887466415578],[1430352000000,0.0358166248478158],[1433030400000,0.0019526043709277],[1435622400000,-0.031671821717306],[1438300800000,0.0201143877332655],[1440979200000,-0.0771524107594885],[1443571200000,-0.0451948528379211],[1446249600000,0.0640259069840723],[1448841600000,-0.00755581380300363],[1451520000000,-0.0235888800009683],[1454198400000,-0.0567578152530044],[1456704000000,-0.0339139019954944],[1459382400000,0.0637455947647125],[1461974400000,0.0219751955771752],[1464652800000,-0.000856107257818373],[1467244800000,-0.0244945616360019],[1469923200000,0.0390001766950951],[1472601600000,0.00532695212623135],[1475193600000,0.0132790445412603],[1477872000000,-0.0224036490141968],[1480464000000,-0.0179745049825604],[1483142400000,0.0267059400895553],[1485820800000,0.0323818455984117],[1488240000000,0.0118364428718687],[1490918400000,0.031805674822321],[1493510400000,0.023952205763865],[1496188800000,0.0348101976378778],[1498780800000,0.00295592222815078],[1501459200000,0.0261879549365212],[1504137600000,-0.000448342511581323],[1506729600000,0.0233428392112245],[1509408000000,0.0166536668188426],[1512000000000,0.00687000462873666],[1514678400000,0.0126869861788821]],\"name\":\"EF\"},{\"data\":[[1359590400000,0.052133434157998],[1362009600000,0.0161752203262813],[1364688000000,0.0402580832292703],[1367280000000,0.00122261321480011],[1369958400000,0.0419763078517352],[1372550400000,-0.00140298022882845],[1375228800000,0.0635411970286119],[1377907200000,-0.0347433318654611],[1380499200000,0.0638705624116289],[1383177600000,0.0342341988066748],[1385769600000,0.0416609210781971],[1388448000000,0.0128910625308851],[1391126400000,-0.0357753308546238],[1393545600000,0.045257403433574],[1396224000000,0.0133145415164817],[1398816000000,-0.0231841210213366],[1401494400000,0.00620534472500545],[1404086400000,0.0377147164939755],[1406764800000,-0.0520095348800771],[1409443200000,0.0436578629086943],[1412035200000,-0.0612640153590247],[1414713600000,0.0688746647171099],[1417305600000,0.0047737389466791],[1419984000000,0.0252944907028176],[1422662400000,-0.054627962916129],[1425081600000,0.0569147661955958],[1427760000000,0.0101585056231697],[1430352000000,-0.0184176369738465],[1433030400000,0.00750990427398879],[1435622400000,0.0041677785664147],[1438300800000,-0.0273752631541226],[1440979200000,-0.0472683504755347],[1443571200000,-0.0384637056673345],[1446249600000,0.0635897287605909],[1448841600000,0.0244152906105626],[1451520000000,-0.0521531627356371],[1454198400000,-0.0603069185320608],[1456704000000,0.020605356723939],[1459382400000,0.0899059462929683],[1461974400000,0.0210441851640972],[1464652800000,0.00439710726549336],[1467244800000,0.00829583176483695],[1469923200000,0.0493483179733056],[1472601600000,0.0112611616239873],[1475193600000,0.00861490263380027],[1477872000000,-0.0381348352501387],[1480464000000,0.125246421927436],[1483142400000,0.0314932238940493],[1485820800000,-0.012143876469545],[1488240000000,0.0134289167098629],[1490918400000,-0.00653315801671628],[1493510400000,0.00510778835636572],[1496188800000,-0.0228626731549069],[1498780800000,0.0291517193790423],[1501459200000,0.00748160967226319],[1504137600000,-0.0275646141045787],[1506729600000,0.0823217200576778],[1509408000000,0.00591598419331252],[1512000000000,0.036913302321242],[1514678400000,0.00308266448511318]],\"name\":\"SC\"},{\"data\":[[1359590400000,-0.00293549467634246],[1362009600000,-0.0231052596741939],[1364688000000,-0.0102350263755713],[1367280000000,0.0120849664436413],[1369958400000,-0.0494836230589017],[1372550400000,-0.0547390407776791],[1375228800000,0.0131598707200435],[1377907200000,-0.0257056023504227],[1380499200000,0.0695887124108685],[1383177600000,0.040861328863957],[1385769600000,-0.00259404692434329],[1388448000000,-0.00407996861310789],[1391126400000,-0.0903223950786187],[1393545600000,0.0332202516086162],[1396224000000,0.038021890900434],[1398816000000,0.00777272126500028],[1401494400000,0.0290912136268129],[1404086400000,0.023725301538279],[1406764800000,0.0135555878931406],[1409443200000,0.0279046871000137],[1412035200000,-0.0808568207320621],[1414713600000,0.0140964689225132],[1417305600000,-0.0155412966888839],[1419984000000,-0.0404415118391337],[1422662400000,-0.00689571010786194],[1425081600000,0.0431360277747306],[1427760000000,-0.0150862050950593],[1430352000000,0.066281436319815],[1433030400000,-0.0419110525605899],[1435622400000,-0.0297403036960313],[1438300800000,-0.0651781778915139],[1440979200000,-0.0936952379862031],[1443571200000,-0.0306420833921925],[1446249600000,0.0618081165703628],[1448841600000,-0.0255601905648062],[1451520000000,-0.0389522446188471],[1454198400000,-0.0516367043051638],[1456704000000,-0.00821160117308617],[1459382400000,0.121879153242042],[1461974400000,0.00407900727307542],[1464652800000,-0.0376283485388047],[1467244800000,0.044581939817089],[1469923200000,0.0524421137569373],[1472601600000,0.00879848202293365],[1475193600000,0.0248728923494523],[1477872000000,-0.00831226919867545],[1480464000000,-0.0451618441401216],[1483142400000,-0.00252388153775174],[1485820800000,0.0644314718150478],[1488240000000,0.01725784005707],[1490918400000,0.0361888529361427],[1493510400000,0.0168664024521998],[1496188800000,0.0280600127994952],[1498780800000,0.00922375557016064],[1501459200000,0.0565945350003898],[1504137600000,0.0232437643859278],[1506729600000,-0.000446242134324759],[1509408000000,0.0322784733486801],[1512000000000,-0.00389691028940131],[1514678400000,0.0322455587601747]],\"name\":\"EM\"},{\"data\":[[1359590400000,-0.00623151656492027],[1362009600000,0.00589122167702172],[1364688000000,0.000984796030780721],[1367280000000,0.00963933935711125],[1369958400000,-0.0202140511353042],[1372550400000,-0.0157781895677278],[1375228800000,0.00268752780811088],[1377907200000,-0.00829796862648013],[1380499200000,0.0111440779750067],[1383177600000,0.00829186188014752],[1385769600000,-0.00250810193746176],[1388448000000,-0.00736741013348396],[1391126400000,0.01529146694471],[1393545600000,0.00375410351569627],[1396224000000,-0.00148116031065193],[1398816000000,0.00818237246380438],[1401494400000,0.0117249433183853],[1404086400000,-0.000575395333918038],[1406764800000,-0.00251627191420845],[1409443200000,0.0114311129078652],[1412035200000,-0.00617056243146052],[1414713600000,0.010584548634017],[1417305600000,0.00654875131577626],[1419984000000,-0.000238229537901091],[1422662400000,0.0203150986621798],[1425081600000,-0.00898673862468158],[1427760000000,0.00373700660991538],[1430352000000,-0.00323536084070408],[1433030400000,-0.00438301227800153],[1435622400000,-0.0108222664054072],[1438300800000,0.00858856112136142],[1440979200000,-0.00336503632355001],[1443571200000,0.00808502392909194],[1446249600000,0.000686048991656918],[1448841600000,-0.00390208153466975],[1451520000000,-0.0038323739361017],[1454198400000,0.0123300966376556],[1456704000000,0.00883175804003056],[1459382400000,0.00870419245246712],[1461974400000,0.00254223924868047],[1464652800000,0.000137186670725598],[1467244800000,0.0191679970902676],[1469923200000,0.00543422700928886],[1472601600000,-0.00215902597865636],[1475193600000,0.0005120336152169],[1477872000000,-0.00820380235848628],[1480464000000,-0.0259919125574175],[1483142400000,0.00253411487820898],[1485820800000,0.0021260786767705],[1488240000000,0.00643853607063782],[1490918400000,-0.00055292739178725],[1493510400000,0.00902929709771882],[1496188800000,0.00684735163689787],[1498780800000,-0.000182775684257841],[1501459200000,0.00333451493060544],[1504137600000,0.00936905228239926],[1506729600000,-0.00573219182215734],[1509408000000,0.000978086259888045],[1512000000000,-0.00148411097344958],[1514678400000,0.00340264722050154]],\"name\":\"BG\"}],\"navigator\":{\"enabled\":false},\"scrollbar\":{\"enabled\":false},\"legend\":{\"enabled\":true}},\"theme\":{\"colors\":[\"#f1c40f\",\"#2ecc71\",\"#9b59b6\",\"#e74c3c\",\"#34495e\",\"#3498db\",\"#1abc9c\",\"#f39c12\",\"#d35400\"],\"chart\":{\"backgroundColor\":\"#ECF0F1\"},\"xAxis\":{\"gridLineDashStyle\":\"Dash\",\"gridLineWidth\":1,\"gridLineColor\":\"#BDC3C7\",\"lineColor\":\"#BDC3C7\",\"minorGridLineColor\":\"#BDC3C7\",\"tickColor\":\"#BDC3C7\",\"tickWidth\":1},\"yAxis\":{\"gridLineDashStyle\":\"Dash\",\"gridLineColor\":\"#BDC3C7\",\"lineColor\":\"#BDC3C7\",\"minorGridLineColor\":\"#BDC3C7\",\"tickColor\":\"#BDC3C7\",\"tickWidth\":1},\"legendBackgroundColor\":\"rgba(0, 0, 0, 0.5)\",\"background2\":\"#505053\",\"dataLabelsColor\":\"#B0B0B3\",\"textColor\":\"#34495e\",\"contrastTextColor\":\"#F0F0F3\",\"maskColor\":\"rgba(255,255,255,0.3)\"},\"conf_opts\":{\"global\":{\"Date\":null,\"VMLRadialGradientURL\":\"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png\",\"canvasToolsURL\":\"http =//code.highcharts.com/list(version)/modules/canvas-tools.js\",\"getTimezoneOffset\":null,\"timezoneOffset\":0,\"useUTC\":true},\"lang\":{\"contextButtonTitle\":\"Chart context menu\",\"decimalPoint\":\".\",\"downloadCSV\":\"Download CSV\",\"downloadJPEG\":\"Download JPEG image\",\"downloadPDF\":\"Download PDF document\",\"downloadPNG\":\"Download PNG image\",\"downloadSVG\":\"Download SVG vector image\",\"downloadXLS\":\"Download XLS\",\"drillUpText\":\"◁ Back to {series.name}\",\"exitFullscreen\":\"Exit from full screen\",\"exportData\":{\"annotationHeader\":\"Annotations\",\"categoryDatetimeHeader\":\"DateTime\",\"categoryHeader\":\"Category\"},\"hideData\":\"Hide data table\",\"invalidDate\":null,\"loading\":\"Loading...\",\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"noData\":\"No data to display\",\"numericSymbolMagnitude\":1000,\"numericSymbols\":[\"k\",\"M\",\"G\",\"T\",\"P\",\"E\"],\"printChart\":\"Print chart\",\"resetZoom\":\"Reset zoom\",\"resetZoomTitle\":\"Reset zoom level 1:1\",\"shortMonths\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"shortWeekdays\":[\"Sat\",\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\"],\"thousandsSep\":\" \",\"viewData\":\"View data table\",\"viewFullscreen\":\"View in full screen\",\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]}},\"type\":\"stock\",\"fonts\":[],\"debug\":false},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n\nMonthly Log Returns\n:::\n:::\n\n\n## Density of each ETF\nInspect each ETF with a histogram and density in @fig-returns-density.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nasset_returns_tidyverse = \n  \t\t\t\t\t\tprices %>% \n  \t\t\t\t\t\tto.monthly(indexAt = \"lastof\", OHLC = FALSE) %>%\n  \t\t\t\t\t\t# convert the index to a date\n  \t\t\t\t\t\tdata.frame(date = index(.)) %>%\n  \t\t\t\t\t\tremove_rownames() %>% \n \t\t\t\t\t\tgather(asset, returns, -date) %>% \n  \t\t\t\t\t\tgroup_by(asset) %>%  \n  \t\t\t\t\t\tmutate(returns = (log(returns) - log(lag(returns)))) %>%\n  \t\t\t\t\t\tspread(asset, returns) %>% \n  \t\t\t\t\t\tselect(date, symbols) %>% \n  \t\t\t\t\t\tna.omit()\n\n  asset_returns_of = \n  \t\t\t\t\tasset_returns_tidyverse %>% \n  \t\t\t\t\tgather(asset, returns, -date)\n\n# ggplot to visualize\nasset_returns_of %>%\n\t\t\tggplot(aes(x = returns)) +\n\t\t\tgeom_density(aes(color = asset), alpha = 1) +\n\t\t\tgeom_histogram(aes(fill = asset), alpha = 0.45, binwidth = .01) +\n\t\t\tguides(fill = FALSE) +\n\t\t\tfacet_wrap(~asset) +\n\t\t\tggtitle(\"Monthly Returns Since 2013-01-31\") +\n\t\t\txlab(\"monthly returns\") +\n\t\t\tylab(\"distribution\") +\n\t\t\ttheme_update(plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![Monthly Returns Density](Portfolio_Analysis_files/figure-html/fig-returns-density-1.png){#fig-returns-density width=672}\n:::\n:::\n\n::: \n\n## Risk Portfolio\n\nIn this section we are calculating some descriptive statistics as the main measure of portfolio risk. We are specifically interested in the dispersion of returns. We are considering the standard deviation that measures the extent to which a portfolio’s returns are dispersed around their mean (A risk or volatile profile has a high standard deviation) and the skewness and kurtosis to see how  a portfolio’s returns are distributed. We are also taking a look at the rolling volatility to make sure we didn't miss anything by considering only the total volatility.\n\n:::{.panel-tabset}\n\n## Portfolio returns\nWe attribute the appropriate weight for each ETF to calculate the returns for one portfolio.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# weights\nw <- c(0.25, 0.25, 0.20, 0.20, 0.10)\n# check if weights are attributed correctly to our ETF and check if the weights sum to 100% \n#tibble(w, symbols)\n#tibble(w, symbols) %>%\n\t\t\t\t\t#summarise(total_weight = sum(w))\n\n# use the weights to convert the returns of 5 assets to the returns of 1 portfolio\n# we can change the parameter rebalance_on to years for annual rebalancing.  \nportfolio_returns_xts_monthly =\n\t\t\t\t\tReturn.portfolio(asset_returns_xts,\n\t\t\t\t\t\tweights = w,\n\t\t\t\t\t\trebalance_on = \"months\") %>%\n                    `colnames<-`(\"returns\")\nhead(portfolio_returns_xts_monthly, 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                 returns\n2013-01-31  0.0308487678\n2013-02-28 -0.0008696533\n2013-03-31  0.0186624177\n2013-04-30  0.0206248788\n2013-05-31 -0.0053528837\n2013-06-30 -0.0229531732\n2013-07-31  0.0411705169\n2013-08-31 -0.0254689186\n2013-09-30  0.0544298113\n2013-10-31  0.0351853479\n```\n:::\n:::\n\n## Visualization of Portfolio returns\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhighchart(type = \"stock\") %>%\n\thc_title(text = \"Portfolio Monthly Returns\") %>%\n\thc_add_series(portfolio_returns_xts_monthly$returns,\n\t\tname = \"Rebalanced Monthly\",\n\t\tcolor = \"darkblue\") %>%\n\thc_add_theme(hc_theme_flat()) %>%\n\thc_navigator(enabled = FALSE) %>%\n\thc_scrollbar(enabled = FALSE) %>%\n\thc_legend(enabled = TRUE) %>%\n\thc_exporting(enabled = TRUE)\n```\n\n::: {#fig-returns-portfolio .cell-output-display}\n```{=html}\n<div class=\"highchart html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-eb052f1c04f33f84c603\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-eb052f1c04f33f84c603\">{\"x\":{\"hc_opts\":{\"chart\":{\"reflow\":true},\"title\":{\"text\":\"Portfolio Monthly Returns\"},\"yAxis\":{\"title\":{\"text\":null}},\"credits\":{\"enabled\":false},\"exporting\":{\"enabled\":true},\"boost\":{\"enabled\":false},\"plotOptions\":{\"series\":{\"label\":{\"enabled\":false},\"turboThreshold\":0},\"treemap\":{\"layoutAlgorithm\":\"squarified\"}},\"series\":[{\"data\":[[1359590400000,0.0308487677736562],[1362009600000,-0.000869653278986138],[1364688000000,0.0186624177492583],[1367280000000,0.0206248788056502],[1369958400000,-0.00535288371127796],[1372550400000,-0.0229531732174333],[1375228800000,0.0411705168587952],[1377907200000,-0.0254689185976785],[1380499200000,0.0544298112740089],[1383177600000,0.0351853478593069],[1385769600000,0.0162266361821988],[1388448000000,0.0128058167978617],[1391126400000,-0.0460148557583023],[1393545600000,0.0420747929607579],[1396224000000,0.0110332838726788],[1398816000000,0.00360017934834289],[1401494400000,0.0179242372476611],[1404086400000,0.0196307713234187],[1406764800000,-0.0179194551561708],[1409443200000,0.0255819466556477],[1412035200000,-0.0424137166345417],[1414713600000,0.0228084631677814],[1417305600000,0.00543301804470642],[1419984000000,-0.013874219700442],[1422662400000,-0.0162359202283748],[1425081600000,0.0481446836149115],[1427760000000,-0.00816689733745357],[1430352000000,0.0206498838644729],[1433030400000,-0.00363681932873627],[1435622400000,-0.0191959616691447],[1438300800000,-0.00714669613722219],[1440979200000,-0.0636440887808625],[1443571200000,-0.0306601687112004],[1446249600000,0.0616156126715233],[1448841600000,-0.0015960161046138],[1451520000000,-0.0288604983023723],[1454198400000,-0.0481123251313778],[1456704000000,-0.00532312924003198],[1459382400000,0.0754384385218663],[1461974400000,0.0117560193657058],[1464652800000,-0.00262942946458966],[1467244800000,0.00723666884359364],[1469923200000,0.0396070611630779],[1472601600000,0.00542694013804068],[1475193600000,0.0100831223946325],[1477872000000,-0.02008297002966],[1480464000000,0.0179681259558373],[1483142400000,0.0177409295276854],[1485820800000,0.0231997215805553],[1488240000000,0.0193751117762351],[1490918400000,0.0141395634780901],[1493510400000,0.013755124423527],[1496188800000,0.0139303145924732],[1498780800000,0.00998447218093612],[1501459200000,0.024782133986623],[1504137600000,0.000688998845730371],[1506729600000,0.0266248746792268],[1509408000000,0.0177228065111805],[1512000000000,0.0156993660369793],[1514678400000,0.0145357971028517]],\"name\":\"Rebalanced Monthly\",\"color\":\"darkblue\"}],\"navigator\":{\"enabled\":false},\"scrollbar\":{\"enabled\":false},\"legend\":{\"enabled\":true}},\"theme\":{\"colors\":[\"#f1c40f\",\"#2ecc71\",\"#9b59b6\",\"#e74c3c\",\"#34495e\",\"#3498db\",\"#1abc9c\",\"#f39c12\",\"#d35400\"],\"chart\":{\"backgroundColor\":\"#ECF0F1\"},\"xAxis\":{\"gridLineDashStyle\":\"Dash\",\"gridLineWidth\":1,\"gridLineColor\":\"#BDC3C7\",\"lineColor\":\"#BDC3C7\",\"minorGridLineColor\":\"#BDC3C7\",\"tickColor\":\"#BDC3C7\",\"tickWidth\":1},\"yAxis\":{\"gridLineDashStyle\":\"Dash\",\"gridLineColor\":\"#BDC3C7\",\"lineColor\":\"#BDC3C7\",\"minorGridLineColor\":\"#BDC3C7\",\"tickColor\":\"#BDC3C7\",\"tickWidth\":1},\"legendBackgroundColor\":\"rgba(0, 0, 0, 0.5)\",\"background2\":\"#505053\",\"dataLabelsColor\":\"#B0B0B3\",\"textColor\":\"#34495e\",\"contrastTextColor\":\"#F0F0F3\",\"maskColor\":\"rgba(255,255,255,0.3)\"},\"conf_opts\":{\"global\":{\"Date\":null,\"VMLRadialGradientURL\":\"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png\",\"canvasToolsURL\":\"http =//code.highcharts.com/list(version)/modules/canvas-tools.js\",\"getTimezoneOffset\":null,\"timezoneOffset\":0,\"useUTC\":true},\"lang\":{\"contextButtonTitle\":\"Chart context menu\",\"decimalPoint\":\".\",\"downloadCSV\":\"Download CSV\",\"downloadJPEG\":\"Download JPEG image\",\"downloadPDF\":\"Download PDF document\",\"downloadPNG\":\"Download PNG image\",\"downloadSVG\":\"Download SVG vector image\",\"downloadXLS\":\"Download XLS\",\"drillUpText\":\"◁ Back to {series.name}\",\"exitFullscreen\":\"Exit from full screen\",\"exportData\":{\"annotationHeader\":\"Annotations\",\"categoryDatetimeHeader\":\"DateTime\",\"categoryHeader\":\"Category\"},\"hideData\":\"Hide data table\",\"invalidDate\":null,\"loading\":\"Loading...\",\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"noData\":\"No data to display\",\"numericSymbolMagnitude\":1000,\"numericSymbols\":[\"k\",\"M\",\"G\",\"T\",\"P\",\"E\"],\"printChart\":\"Print chart\",\"resetZoom\":\"Reset zoom\",\"resetZoomTitle\":\"Reset zoom level 1:1\",\"shortMonths\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"shortWeekdays\":[\"Sat\",\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\"],\"thousandsSep\":\" \",\"viewData\":\"View data table\",\"viewFullscreen\":\"View in full screen\",\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]}},\"type\":\"stock\",\"fonts\":[],\"debug\":false},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n\nPortfolio Monthly Returns Line Chart\n:::\n:::\n\n\n## Standard deviation\n\nThe @fig-returns-scatter shows that $2015$ was the riskiest year. The $\\textcolor{red}{red}$ points represent the returns that are one standard deviation below the mean and the $\\textcolor{green}{green}$ points represent the ones above the mean. We see that we don't have any monthly returns that are at least one standard deviation from the mean during $2017$.\n\n\n\n### Scatter of returns\n\n::: {.cell}\n\n```{.r .cell-code}\nportfolio_sd = round(StdDev(asset_returns_xts, weights = w)*100,2)[1,1]\n\n# portfolio returns \n\nportfolio_returns_tq_monthly =\n\t\tasset_returns_of %>%\n\t\ttq_portfolio(assets_col = asset,\n\t\t\treturns_col = returns,\n\t\t\tweights = w,\n\t\t\tcol_rename = \"returns\",\n\t\t\trebalance_on = \"months\")\n\n# Viz of portfolio returns / scatter plot \nsd_viz = sd(portfolio_returns_tq_monthly$returns)\nmean_viz = mean(portfolio_returns_tq_monthly$returns)\n\nportfolio_returns_tq_monthly %>%\n\tmutate(hist_col_red =\n\t\t\tif_else(returns < (mean_viz - sd_viz),\n\t\t\t\treturns, as.numeric(NA)),\n\t\thist_col_green =\n\t\t\tif_else(returns > (mean_viz + sd_viz),\n\t\t\t\treturns, as.numeric(NA)),\n\t\thist_col_blue =\n\t\t\tif_else(returns > (mean_viz - sd_viz) &\n\t\t\t\treturns < (mean_viz + sd_viz),\n\t\t\t\treturns, as.numeric(NA))) %>%\n\tggplot(aes(x = date)) +\n\tgeom_point(aes(y = hist_col_red),\n\t\t\t\tcolor = \"red\") +\n\tgeom_point(aes(y = hist_col_green),\n\t\t\t\tcolor = \"#006600\") +\n\tgeom_point(aes(y = hist_col_blue),\n\t\t\t\tcolor = \"blue\") +\n\tgeom_hline(yintercept = (mean_viz + sd_viz),\n\t\t\t\tcolor = \"black\",\n\t\t\t\tlinetype = \"longdash\") +\n\tgeom_hline(yintercept = (mean_viz-sd_viz),\n\t\t\t\tcolor = \"black\",\n\t\t\t\tlinetype = \"longdash\") +\n\tlabs(title = \"Scatter Plot with one standard deviation above and below the mean\", y = \"monthly returns\") +\n\tscale_x_date(breaks = pretty_breaks(n = 8)) +\n\ttheme(plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![Scatter of Returns](Portfolio_Analysis_files/figure-html/fig-returns-scatter-1.png){#fig-returns-scatter width=672}\n:::\n:::\n\n\n### Expected returns vs Risk\n\nHere we are visualizing the expected mean returns in comparison with the standard deviation of monthly returns (risk profile).  We can see that S $\\&$ P $500$ has a higher expected return for a little more risk, EM  and EF with high risk and low expected return, and finally SC with high risk but with high expected return. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nasset_returns_of %>%\n\tgroup_by(asset) %>%\n\tsummarise(expected_return = mean(returns),\t\n\t\t\tstand_dev = sd(returns)) %>%\n\tadd_row(asset = \"Portfolio\",\n\t stand_dev =\n\t\tsd(portfolio_returns_tq_monthly$returns),\n\t expected_return =\n\t\tmean(portfolio_returns_tq_monthly$returns)) %>%\n\tggplot(aes(x = stand_dev,\n\t\t\t y = expected_return,\n\t\t\t color = asset)) +\n\tgeom_point(size = 2) +\n\tgeom_text(\n\t\taes(x =\n\t\t\tsd(portfolio_returns_tq_monthly$returns) * 1.11,\n\t\t\ty =\n\t\t\tmean(portfolio_returns_tq_monthly$returns),\n\tlabel = \"Portfolio\")) +\n\tylab(\"expected return\") +\n\txlab(\"standard deviation\") +\n\tggtitle(\"Expected Monthly Returns versus Risk\") +\n\tscale_y_continuous(labels = function(x){ paste0(x, \"%\")}) +\n\ttheme_update(plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](Portfolio_Analysis_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\n### Rolling Volatility\n\nFor better management of volatility, it is a good idea to take allok at rolling windows.  We are considering a window of $24$ months to see how the volatility has behaved over time in order to make better hypotheses about the past causes, future probabilities and rebalancing.\n\nIn @fig-returns-scatter during $2017$ we had zero monthly returns that are lest one standard deviation from the mean which translates to low rolling volatility as the $24$ month rolling portfolio volatility @fig-rolling-port confirms, since we have a spike in rolling volatility in $2016$ followed by a consist falling volatility through mid $2017$.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# window of 24 months\n\nwindow = 24\n\nportfolio_rolling_sd = \n\trollapply(portfolio_returns_xts_monthly,\n\t\t\t\tFUN = sd,\n\t\t\t\twidth = window) %>%\n\tna.omit() %>%\n\t`colnames<-`(\"rolling_sd\")\n\nhighchart(type = \"stock\") %>%\n\thc_title(text = \"24-Month Rolling Volatility\") %>%\n\thc_add_series(round(portfolio_rolling_sd, 4) * 100,\n\t\tcolor = \"darkblue\") %>%\n\thc_add_theme(hc_theme_flat()) %>%\n\thc_yAxis(\n\t\tlabels = list(format = \"{value}%\"),\n\t\topposite = FALSE) %>%\n\thc_navigator(enabled = FALSE) %>%\n\thc_scrollbar(enabled = FALSE) %>%\n\thc_exporting(enabled= TRUE) %>%\n\thc_legend(enabled = TRUE)\n```\n\n::: {#fig-rolling-port .cell-output-display}\n```{=html}\n<div class=\"highchart html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-7ae635457998d82365a3\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-7ae635457998d82365a3\">{\"x\":{\"hc_opts\":{\"chart\":{\"reflow\":true},\"title\":{\"text\":\"24-Month Rolling Volatility\"},\"yAxis\":{\"title\":{\"text\":null},\"labels\":{\"format\":\"{value}%\"},\"opposite\":false},\"credits\":{\"enabled\":false},\"exporting\":{\"enabled\":true},\"boost\":{\"enabled\":false},\"plotOptions\":{\"series\":{\"label\":{\"enabled\":false},\"turboThreshold\":0},\"treemap\":{\"layoutAlgorithm\":\"squarified\"}},\"series\":[{\"data\":[[1419984000000,2.62],[1422662400000,2.62],[1425081600000,2.75],[1427760000000,2.76],[1430352000000,2.76],[1433030400000,2.76],[1435622400000,2.74],[1438300800000,2.66],[1440979200000,2.95],[1443571200000,2.83],[1446249600000,3.01],[1448841600000,3],[1451520000000,3.05],[1454198400000,3.06],[1456704000000,2.92],[1459382400000,3.32],[1461974400000,3.33],[1464652800000,3.31],[1467244800000,3.29],[1469923200000,3.37],[1472601600000,3.33],[1475193600000,3.21],[1477872000000,3.21],[1480464000000,3.23],[1483142400000,3.23],[1485820800000,3.23],[1488240000000,3.11],[1490918400000,3.11],[1493510400000,3.09],[1496188800000,3.1],[1498780800000,3.06],[1501459200000,3.07],[1504137600000,2.68],[1506729600000,2.56],[1509408000000,2.34],[1512000000000,2.33],[1514678400000,2.17]],\"color\":\"darkblue\"}],\"navigator\":{\"enabled\":false},\"scrollbar\":{\"enabled\":false},\"legend\":{\"enabled\":true}},\"theme\":{\"colors\":[\"#f1c40f\",\"#2ecc71\",\"#9b59b6\",\"#e74c3c\",\"#34495e\",\"#3498db\",\"#1abc9c\",\"#f39c12\",\"#d35400\"],\"chart\":{\"backgroundColor\":\"#ECF0F1\"},\"xAxis\":{\"gridLineDashStyle\":\"Dash\",\"gridLineWidth\":1,\"gridLineColor\":\"#BDC3C7\",\"lineColor\":\"#BDC3C7\",\"minorGridLineColor\":\"#BDC3C7\",\"tickColor\":\"#BDC3C7\",\"tickWidth\":1},\"yAxis\":{\"gridLineDashStyle\":\"Dash\",\"gridLineColor\":\"#BDC3C7\",\"lineColor\":\"#BDC3C7\",\"minorGridLineColor\":\"#BDC3C7\",\"tickColor\":\"#BDC3C7\",\"tickWidth\":1},\"legendBackgroundColor\":\"rgba(0, 0, 0, 0.5)\",\"background2\":\"#505053\",\"dataLabelsColor\":\"#B0B0B3\",\"textColor\":\"#34495e\",\"contrastTextColor\":\"#F0F0F3\",\"maskColor\":\"rgba(255,255,255,0.3)\"},\"conf_opts\":{\"global\":{\"Date\":null,\"VMLRadialGradientURL\":\"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png\",\"canvasToolsURL\":\"http =//code.highcharts.com/list(version)/modules/canvas-tools.js\",\"getTimezoneOffset\":null,\"timezoneOffset\":0,\"useUTC\":true},\"lang\":{\"contextButtonTitle\":\"Chart context menu\",\"decimalPoint\":\".\",\"downloadCSV\":\"Download CSV\",\"downloadJPEG\":\"Download JPEG image\",\"downloadPDF\":\"Download PDF document\",\"downloadPNG\":\"Download PNG image\",\"downloadSVG\":\"Download SVG vector image\",\"downloadXLS\":\"Download XLS\",\"drillUpText\":\"◁ Back to {series.name}\",\"exitFullscreen\":\"Exit from full screen\",\"exportData\":{\"annotationHeader\":\"Annotations\",\"categoryDatetimeHeader\":\"DateTime\",\"categoryHeader\":\"Category\"},\"hideData\":\"Hide data table\",\"invalidDate\":null,\"loading\":\"Loading...\",\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"noData\":\"No data to display\",\"numericSymbolMagnitude\":1000,\"numericSymbols\":[\"k\",\"M\",\"G\",\"T\",\"P\",\"E\"],\"printChart\":\"Print chart\",\"resetZoom\":\"Reset zoom\",\"resetZoomTitle\":\"Reset zoom level 1:1\",\"shortMonths\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"shortWeekdays\":[\"Sat\",\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\"],\"thousandsSep\":\" \",\"viewData\":\"View data table\",\"viewFullscreen\":\"View in full screen\",\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]}},\"type\":\"stock\",\"fonts\":[],\"debug\":false},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n\nRolling Portfolio Volatility\n:::\n:::\n\n\n\n\n## Skewness\n\n\n### Returns Histogram\n\nWe have a negative skew distribution of monthly returns meaning  multilple small positive returns and a few large negative returns. The $\\textcolor{red}{red}$ rectangles in @fig-skew_hist represents the monthly returns that fall $2$ standard deviations below the mean. One could be more conservative regarding the choice of threshold and depending on which returns one are interested in to. We can see that we have:\n\n* One highly negative return less than $-0.06$\n* One highly positive return greater than $-0.06$\n* A cluster of negative returns around $-0.02$ \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nskew_xts = skewness(portfolio_returns_xts_monthly$returns)\nmean_xts = mean(portfolio_returns_xts_monthly$returns)\nmedian_xts = median(portfolio_returns_xts_monthly$returns)\n\nsome_stats = data.frame(Statistics = c(\"mean\",\n\t\t\t\t\t\t\"median\"),\n\t\t\t\t\t\tvalue = c(mean_xts,\n\t\t\t\t\t\t\t\t median_xts)) \nportfolio_returns_tq_monthly %>%\n\tmutate(hist_col_red =\n\t\t\t\tif_else(returns < (mean(returns) - 2*sd(returns)),\n\t\t\t\treturns, as.numeric(NA)),\n\t\t\t\treturns =\n\t\t\t\tif_else(returns > (mean(returns) - 2*sd(returns)),\n\t\t\t\treturns, as.numeric(NA))) %>%\n\tggplot(aes(returns)) +\n\tgeom_histogram(aes(x = hist_col_red),\n\t\t\talpha = .7,\n\t\t\tbinwidth = .005,\n\t\t\tfill = \"red\",\n\t\t\tcolor = \"red\") +\n\tgeom_histogram(aes(x = returns),\n\t\t\talpha = .7,\n\t\t\tbinwidth = .005,\n\t\t\tfill = \"darkblue\",\n\t\t\tcolor = \"darkblue\") +\n\t#geom_density(col = \"darkblue\") + \n    geom_vline(data = some_stats, aes(xintercept = value,\n                               linetype = Statistics,\n                               col = Statistics), linewidth = 1)+\nscale_x_continuous(breaks = pretty_breaks(n = 10)) +\nxlab(\"monthly returns\")\n```\n\n::: {.cell-output-display}\n![Returns Histogram](Portfolio_Analysis_files/figure-html/fig-skew_hist-1.png){#fig-skew_hist width=672}\n:::\n:::\n\n\n### Rolling Skewness \n\nEven if the overall skewness is negative as we have seen (@fig-skew_hist), the $24$ month skewness in @fig-skew_rolling has been positive for about half the lifetime of the portfolio.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwindow = 24\nrolling_skew_xts = rollapply(portfolio_returns_xts_monthly,\n\t\t\t\t\t\t\tFUN = skewness,\n\t\t\t\t\t\t\twidth = window) %>%\n\t\t\t\t\tna.omit()\n\n\thighchart(type = \"stock\") %>%\n\t\thc_title(text = \"Rolling 24-Month Skewness\") %>%\n\t\thc_add_series(rolling_skew_xts,\n\t\t\t\t\t\tname = \"Rolling skewness\",\n\t\t\t\t\t\tcolor = \"darkblue\") %>%\n\t\t\t\t\t\thc_yAxis(title = list(text = \"skewness\"),\n\t\t\t\t\t\topposite = FALSE,\n\t\t\t\t\t\tmax = 1,\n\t\t\t\t\t\tmin = -1) %>%\n\t\thc_navigator(enabled = FALSE) %>%\n\t\thc_scrollbar(enabled = FALSE) %>%\n\t\thc_add_theme(hc_theme_flat()) %>%\n\t\thc_exporting(enabled = TRUE)\n```\n\n::: {#fig-skew_rolling .cell-output-display}\n```{=html}\n<div class=\"highchart html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-c836a8d7fbaefdda6e83\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-c836a8d7fbaefdda6e83\">{\"x\":{\"hc_opts\":{\"chart\":{\"reflow\":true},\"title\":{\"text\":\"Rolling 24-Month Skewness\"},\"yAxis\":{\"title\":{\"text\":\"skewness\"},\"opposite\":false,\"max\":1,\"min\":-1},\"credits\":{\"enabled\":false},\"exporting\":{\"enabled\":true},\"boost\":{\"enabled\":false},\"plotOptions\":{\"series\":{\"label\":{\"enabled\":false},\"turboThreshold\":0},\"treemap\":{\"layoutAlgorithm\":\"squarified\"}},\"series\":[{\"data\":[[1419984000000,-0.451445818045215],[1422662400000,-0.285729024111847],[1425081600000,-0.320507197924725],[1427760000000,-0.204341685633131],[1430352000000,-0.204418162016434],[1433030400000,-0.21153245972622],[1435622400000,-0.2131096658811],[1438300800000,-0.0971805183622694],[1440979200000,-0.428280837280172],[1443571200000,-0.433344762867999],[1446249600000,-0.167655823534503],[1448841600000,-0.0995969669325511],[1451520000000,0.0359306778045921],[1454198400000,0.0234017427689866],[1456704000000,0.0923117711159207],[1459382400000,0.39392052257868],[1461974400000,0.361743174775439],[1464652800000,0.44117365982673],[1467244800000,0.488940838412696],[1469923200000,0.32037750692967],[1472601600000,0.391478381138539],[1475193600000,0.334716262662977],[1477872000000,0.47848700677723],[1480464000000,0.427505461649331],[1483142400000,0.312713855892959],[1485820800000,0.176739032067602],[1488240000000,0.195479949422309],[1490918400000,0.108148751586469],[1493510400000,0.13235357185423],[1496188800000,0.0617529043476864],[1498780800000,-0.0372357412847154],[1501459200000,-0.155650320616236],[1504137600000,0.265572169401224],[1506729600000,0.203690270915865],[1509408000000,0.0832721379705332],[1512000000000,-0.0041580638804793],[1514678400000,0.0112145008084051]],\"name\":\"Rolling skewness\",\"color\":\"darkblue\"}],\"navigator\":{\"enabled\":false},\"scrollbar\":{\"enabled\":false}},\"theme\":{\"colors\":[\"#f1c40f\",\"#2ecc71\",\"#9b59b6\",\"#e74c3c\",\"#34495e\",\"#3498db\",\"#1abc9c\",\"#f39c12\",\"#d35400\"],\"chart\":{\"backgroundColor\":\"#ECF0F1\"},\"xAxis\":{\"gridLineDashStyle\":\"Dash\",\"gridLineWidth\":1,\"gridLineColor\":\"#BDC3C7\",\"lineColor\":\"#BDC3C7\",\"minorGridLineColor\":\"#BDC3C7\",\"tickColor\":\"#BDC3C7\",\"tickWidth\":1},\"yAxis\":{\"gridLineDashStyle\":\"Dash\",\"gridLineColor\":\"#BDC3C7\",\"lineColor\":\"#BDC3C7\",\"minorGridLineColor\":\"#BDC3C7\",\"tickColor\":\"#BDC3C7\",\"tickWidth\":1},\"legendBackgroundColor\":\"rgba(0, 0, 0, 0.5)\",\"background2\":\"#505053\",\"dataLabelsColor\":\"#B0B0B3\",\"textColor\":\"#34495e\",\"contrastTextColor\":\"#F0F0F3\",\"maskColor\":\"rgba(255,255,255,0.3)\"},\"conf_opts\":{\"global\":{\"Date\":null,\"VMLRadialGradientURL\":\"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png\",\"canvasToolsURL\":\"http =//code.highcharts.com/list(version)/modules/canvas-tools.js\",\"getTimezoneOffset\":null,\"timezoneOffset\":0,\"useUTC\":true},\"lang\":{\"contextButtonTitle\":\"Chart context menu\",\"decimalPoint\":\".\",\"downloadCSV\":\"Download CSV\",\"downloadJPEG\":\"Download JPEG image\",\"downloadPDF\":\"Download PDF document\",\"downloadPNG\":\"Download PNG image\",\"downloadSVG\":\"Download SVG vector image\",\"downloadXLS\":\"Download XLS\",\"drillUpText\":\"◁ Back to {series.name}\",\"exitFullscreen\":\"Exit from full screen\",\"exportData\":{\"annotationHeader\":\"Annotations\",\"categoryDatetimeHeader\":\"DateTime\",\"categoryHeader\":\"Category\"},\"hideData\":\"Hide data table\",\"invalidDate\":null,\"loading\":\"Loading...\",\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"noData\":\"No data to display\",\"numericSymbolMagnitude\":1000,\"numericSymbols\":[\"k\",\"M\",\"G\",\"T\",\"P\",\"E\"],\"printChart\":\"Print chart\",\"resetZoom\":\"Reset zoom\",\"resetZoomTitle\":\"Reset zoom level 1:1\",\"shortMonths\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"shortWeekdays\":[\"Sat\",\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\"],\"thousandsSep\":\" \",\"viewData\":\"View data table\",\"viewFullscreen\":\"View in full screen\",\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]}},\"type\":\"stock\",\"fonts\":[],\"debug\":false},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n\nRolling Skewness\n:::\n:::\n\n\n\n## Kurtosis\n\nSince it will be the same work as we did in skewness for the returns visualization part, except now we are more interested in both tails. One could repeat the exact same code and marking or shading the tails at 2 standard deviations above and below the mean return. We are goin straight to the rolling Kurtosis. \n\nOne should keep in mind that the normal distribution has a kurtosis of $3$, and a distribution with kurtosis less than $3$ or greater than $3$ means that we have fewer returns in the tails than the normal or we have more returns in the tails than the normal, respectively. This measure is important because more bad returns in the tails means that the portfolio might be at risk of a rare but huge downside event. The $24$ month kurtosis in @fig-kurt_rolling shows an increasing rolling kurtosis since $2015$, the risk level increased at the end of the period exceeding three.  \n\n\n::: {.cell}\n\n```{.r .cell-code}\nkurt_xts = kurtosis(portfolio_returns_xts_monthly$returns)\nwindow = 24\n\trolling_kurt_xts = rollapply  (portfolio_returns_xts_monthly,\n\t\tFUN = kurtosis,\n\t\twidth = window) %>%\nna.omit()\nhighchart(type = \"stock\") %>%\n\thc_title(text = \"Rolling 24-Month kurtosis\") %>%\n\thc_add_series(rolling_kurt_xts,\n\t\t\t\tname = \"Rolling 24-Month kurtosis\",\n\t\t\t\tcolor = \"darkblue\") %>%\n\thc_yAxis(title = list(text = \"kurtosis\"),\n\t\t\topposite = FALSE) %>%\n\thc_add_theme(hc_theme_flat()) %>%\n\thc_navigator(enabled = FALSE) %>%\n\thc_scrollbar(enabled = FALSE) %>%\n\thc_exporting(enabled = TRUE)\n```\n\n::: {#fig-kurt_rolling .cell-output-display}\n```{=html}\n<div class=\"highchart html-widget html-fill-item-overflow-hidden html-fill-item\" id=\"htmlwidget-b011eca2d27bcac08dbd\" style=\"width:100%;height:464px;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-b011eca2d27bcac08dbd\">{\"x\":{\"hc_opts\":{\"chart\":{\"reflow\":true},\"title\":{\"text\":\"Rolling 24-Month kurtosis\"},\"yAxis\":{\"title\":{\"text\":\"kurtosis\"},\"opposite\":false},\"credits\":{\"enabled\":false},\"exporting\":{\"enabled\":true},\"boost\":{\"enabled\":false},\"plotOptions\":{\"series\":{\"label\":{\"enabled\":false},\"turboThreshold\":0},\"treemap\":{\"layoutAlgorithm\":\"squarified\"}},\"series\":[{\"data\":[[1419984000000,-0.45295275435272],[1422662400000,-0.569219429087445],[1425081600000,-0.689580874386536],[1427760000000,-0.766989944901912],[1430352000000,-0.767108762706002],[1433030400000,-0.755329815334189],[1435622400000,-0.722578531880766],[1438300800000,-0.609617605225619],[1440979200000,-0.215674999259388],[1443571200000,-0.373198542032366],[1446249600000,-0.26145795237513],[1448841600000,-0.220276385946268],[1451520000000,-0.363595636249227],[1454198400000,-0.367770408780077],[1456704000000,-0.0424714246475086],[1459382400000,-0.00317293418778819],[1461974400000,-0.0477802502850238],[1464652800000,0.0682574982581836],[1467244800000,0.180706443559267],[1469923200000,-0.147443773840722],[1472601600000,0.0108249990660134],[1475193600000,0.233221057834974],[1477872000000,0.321570143030903],[1480464000000,0.220936357559633],[1483142400000,0.158015945135627],[1485820800000,0.104496454912564],[1488240000000,0.451159742859414],[1490918400000,0.438435956193613],[1493510400000,0.497677631600649],[1496188800000,0.475524716639443],[1498780800000,0.638273885902597],[1501459200000,0.604146784773212],[1504137600000,0.834700144597976],[1506729600000,1.21546243390447],[1509408000000,2.1340143062624],[1512000000000,2.22390624053824],[1514678400000,3.37157542099355]],\"name\":\"Rolling 24-Month kurtosis\",\"color\":\"darkblue\"}],\"navigator\":{\"enabled\":false},\"scrollbar\":{\"enabled\":false}},\"theme\":{\"colors\":[\"#f1c40f\",\"#2ecc71\",\"#9b59b6\",\"#e74c3c\",\"#34495e\",\"#3498db\",\"#1abc9c\",\"#f39c12\",\"#d35400\"],\"chart\":{\"backgroundColor\":\"#ECF0F1\"},\"xAxis\":{\"gridLineDashStyle\":\"Dash\",\"gridLineWidth\":1,\"gridLineColor\":\"#BDC3C7\",\"lineColor\":\"#BDC3C7\",\"minorGridLineColor\":\"#BDC3C7\",\"tickColor\":\"#BDC3C7\",\"tickWidth\":1},\"yAxis\":{\"gridLineDashStyle\":\"Dash\",\"gridLineColor\":\"#BDC3C7\",\"lineColor\":\"#BDC3C7\",\"minorGridLineColor\":\"#BDC3C7\",\"tickColor\":\"#BDC3C7\",\"tickWidth\":1},\"legendBackgroundColor\":\"rgba(0, 0, 0, 0.5)\",\"background2\":\"#505053\",\"dataLabelsColor\":\"#B0B0B3\",\"textColor\":\"#34495e\",\"contrastTextColor\":\"#F0F0F3\",\"maskColor\":\"rgba(255,255,255,0.3)\"},\"conf_opts\":{\"global\":{\"Date\":null,\"VMLRadialGradientURL\":\"http =//code.highcharts.com/list(version)/gfx/vml-radial-gradient.png\",\"canvasToolsURL\":\"http =//code.highcharts.com/list(version)/modules/canvas-tools.js\",\"getTimezoneOffset\":null,\"timezoneOffset\":0,\"useUTC\":true},\"lang\":{\"contextButtonTitle\":\"Chart context menu\",\"decimalPoint\":\".\",\"downloadCSV\":\"Download CSV\",\"downloadJPEG\":\"Download JPEG image\",\"downloadPDF\":\"Download PDF document\",\"downloadPNG\":\"Download PNG image\",\"downloadSVG\":\"Download SVG vector image\",\"downloadXLS\":\"Download XLS\",\"drillUpText\":\"◁ Back to {series.name}\",\"exitFullscreen\":\"Exit from full screen\",\"exportData\":{\"annotationHeader\":\"Annotations\",\"categoryDatetimeHeader\":\"DateTime\",\"categoryHeader\":\"Category\"},\"hideData\":\"Hide data table\",\"invalidDate\":null,\"loading\":\"Loading...\",\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"noData\":\"No data to display\",\"numericSymbolMagnitude\":1000,\"numericSymbols\":[\"k\",\"M\",\"G\",\"T\",\"P\",\"E\"],\"printChart\":\"Print chart\",\"resetZoom\":\"Reset zoom\",\"resetZoomTitle\":\"Reset zoom level 1:1\",\"shortMonths\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"shortWeekdays\":[\"Sat\",\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\"],\"thousandsSep\":\" \",\"viewData\":\"View data table\",\"viewFullscreen\":\"View in full screen\",\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]}},\"type\":\"stock\",\"fonts\":[],\"debug\":false},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n\nRolling Kurtosis\n:::\n:::\n\n:::\n\n",
    "supporting": [
      "Portfolio_Analysis_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/htmlwidgets-1.6.0/htmlwidgets.js\"></script>\r\n<script src=\"site_libs/jquery-3.5.1/jquery.min.js\"></script>\r\n<script src=\"site_libs/proj4js-2.3.15/proj4.js\"></script>\r\n<link href=\"site_libs/highcharts-9.3.1/css/motion.css\" rel=\"stylesheet\" />\r\n<script src=\"site_libs/highcharts-9.3.1/highcharts.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/highcharts-3d.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/highcharts-more.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/stock.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/map.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/data.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/exporting.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/offline-exporting.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/drilldown.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/item-series.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/overlapping-datalabels.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/annotations.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/export-data.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/funnel.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/heatmap.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/treemap.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/sankey.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/dependency-wheel.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/organization.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/solid-gauge.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/streamgraph.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/sunburst.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/vector.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/wordcloud.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/xrange.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/tilemap.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/venn.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/gantt.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/timeline.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/parallel-coordinates.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/bullet.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/coloraxis.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/dumbbell.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/lollipop.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/series-label.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/plugins/motion.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/custom/reset.js\"></script>\r\n<script src=\"site_libs/highcharts-9.3.1/modules/boost.js\"></script>\r\n<script src=\"site_libs/highchart-binding-0.9.4/highchart.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}